<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TimeDash Settings</title>
    <link rel="stylesheet" href="options.css" />
</head>

<body>
    <div class="container" role="region" aria-label="TimeDash settings">
        <div id="banner" class="banner" role="status" aria-live="polite" style="display: none"></div>
        <!-- Header -->
        <header class="header" role="banner">
            <div class="header-content">
                <img src="../icons/Logo.svg" alt="TimeDash" class="logo" />
                <div class="header-text">
                    <h1 data-i18n="settings">TimeDash Settings</h1>
                    <p>Changes are saved automatically</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="exportBtn" class="btn btn-outline">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                    </svg>
                    Export Data
                </button>
                <button id="resetBtn" class="btn btn-danger">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                    </svg>
                    Reset All Data
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Navigation Tabs -->
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="general">General</button>
                <button class="tab-btn" data-tab="video">Video Control</button>
                <button class="tab-btn" data-tab="blocking">Site Blocking</button>
                <button class="tab-btn" data-tab="analytics">Analytics</button>
                <button class="tab-btn" data-tab="privacy">Privacy</button>
                <button class="tab-btn" data-tab="help">Help</button>
            </nav>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- General Settings -->
                <div id="general" class="tab-pane active">
                    <div class="settings-section">
                        <h2>Time Tracking</h2>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="trackingEnabled" checked />
                                <span class="checkmark"></span>
                                Enable time tracking
                                <small>Track time spent on websites</small>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="dailyLimit">Daily Time Limit (minutes)</label>
                            <input type="number" id="dailyLimit" min="0" max="1440" placeholder="0 = no limit" />
                            <small>Set 0 for no daily limit</small>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Notifications</h2>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="notificationsEnabled" checked />
                                <span class="checkmark"></span>
                                Enable notifications
                                <small>Get alerts for limits and milestones</small>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="quotaWarnings" checked />
                                <span class="checkmark"></span>
                                Quota warnings
                                <small>Warn when approaching daily limits</small>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Appearance</h2>
                        <div class="setting-group">
                            <label for="theme">Theme</label>
                            <select id="theme">
                                <option value="auto">Auto (System)</option>
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="accentColor">Accent Color</label>
                            <div class="color-picker-grid" id="accentColorPicker">
                                <button type="button" class="color-swatch" data-color="blue"
                                    style="background: #2196f3;" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="purple"
                                    style="background: #9c27b0;" title="Purple"></button>
                                <button type="button" class="color-swatch" data-color="green"
                                    style="background: #4caf50;" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="orange"
                                    style="background: #ff9800;" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="red" style="background: #f44336;"
                                    title="Red"></button>
                                <button type="button" class="color-swatch" data-color="teal"
                                    style="background: #009688;" title="Teal"></button>
                                <button type="button" class="color-swatch" data-color="pink"
                                    style="background: #e91e63;" title="Pink"></button>
                                <button type="button" class="color-swatch" data-color="cyan"
                                    style="background: #00bcd4;" title="Cyan"></button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label for="overlayColor">Speed Popup Color</label>
                            <div class="color-picker-grid" id="overlayColorPicker">
                                <button type="button" class="color-swatch" data-color="blue"
                                    style="background: #2196f3;" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="purple"
                                    style="background: #9c27b0;" title="Purple"></button>
                                <button type="button" class="color-swatch" data-color="green"
                                    style="background: #4caf50;" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="orange"
                                    style="background: #ff9800;" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="red" style="background: #f44336;"
                                    title="Red"></button>
                                <button type="button" class="color-swatch" data-color="teal"
                                    style="background: #009688;" title="Teal"></button>
                                <button type="button" class="color-swatch" data-color="pink"
                                    style="background: #e91e63;" title="Pink"></button>
                                <button type="button" class="color-swatch" data-color="cyan"
                                    style="background: #00bcd4;" title="Cyan"></button>
                            </div>
                            <small>Color of the playback speed overlay on videos</small>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="badgeEnabled" checked />
                                <span class="checkmark"></span>
                                Show badge counter
                                <small>Display time or status on extension icon</small>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Video Control Settings -->
                <div id="video" class="tab-pane">
                    <div class="settings-section">
                        <h2>Video Playback</h2>
                        <div class="setting-group">
                            <label for="defaultSpeed">Default Speed</label>
                            <input type="number" id="defaultSpeed" min="0.5" max="16" step="0.1" placeholder="1.0" />
                        </div>
                        <div class="setting-group">
                            <label for="maxSpeed">Max Speed</label>
                            <input type="number" id="maxSpeed" min="0.5" max="16" step="0.1" placeholder="16.0" />
                        </div>
                        <div class="setting-group">
                            <label for="speedStep">Speed Step</label>
                            <input type="number" id="speedStep" min="0.05" max="1" step="0.05" placeholder="0.25" />
                            <small>Amount to change speed when using shortcuts</small>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Keyboard Shortcuts</h2>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="keyboardShortcuts" checked />
                                <span class="checkmark"></span>
                                Enable keyboard shortcuts
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="increaseSpeedKey">Increase Speed Key</label>
                            <input type="text" id="increaseSpeedKey" class="keybind-input" placeholder="Click to set"
                                readonly />
                        </div>
                        <div class="setting-group">
                            <label for="decreaseSpeedKey">Decrease Speed Key</label>
                            <input type="text" id="decreaseSpeedKey" class="keybind-input" placeholder="Click to set"
                                readonly />
                        </div>
                        <div class="setting-group">
                            <label for="resetSpeedKey">Reset Speed Key</label>
                            <input type="text" id="resetSpeedKey" class="keybind-input" placeholder="Click to set"
                                readonly />
                        </div>
                    </div>
                </div>

                <!-- Site Blocking Settings -->
                <div id="blocking" class="tab-pane">
                    <!-- Hard Blocked Section -->
                    <div class="settings-section">
                        <h2>Hard Blocked Sites</h2>
                        <p class="section-description">
                            These sites are <strong>completely inaccessible</strong>. Any attempt to visit them will
                            immediately redirect to the block page.
                        </p>
                        <div class="rule-manager" id="blockedManager">
                            <div class="rule-input-group">
                                <input type="text" id="blockedDomainInput" placeholder="e.g., facebook.com"
                                    class="rule-domain-input" />
                                <button id="addBlockedBtn" class="btn btn-primary">Add</button>
                            </div>
                            <ul class="rule-list" id="blockedList">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                    </div>

                    <!-- Restricted Access Section -->
                    <div class="settings-section">
                        <h2>Restricted Access Sites</h2>
                        <p class="section-description">
                            These sites are allowed for a <strong>limited time per day</strong>. Once the limit is
                            exceeded, they will be blocked until the next day.
                        </p>
                        <div class="rule-manager" id="restrictedManager">
                            <div class="rule-input-group">
                                <input type="text" id="restrictedDomainInput" placeholder="e.g., youtube.com"
                                    class="rule-domain-input" />
                                <input type="number" id="restrictedLimitInput" placeholder="30" min="1" max="1440"
                                    class="rule-limit-input" title="Daily limit in minutes" />
                                <span class="limit-suffix">min/day</span>
                                <button id="addRestrictedBtn" class="btn btn-primary">Add</button>
                            </div>
                            <ul class="rule-list" id="restrictedList">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Analytics Dashboard -->
                <div id="analytics" class="tab-pane">
                    <!-- Quick Stats -->
                    <div class="settings-section">
                        <h2>Usage Overview</h2>
                        <div class="analytics-stats">
                            <div class="analytics-stat-card">
                                <div class="analytics-stat-value" id="analyticsTodayTotal">0m</div>
                                <div class="analytics-stat-label">Today</div>
                            </div>
                            <div class="analytics-stat-card">
                                <div class="analytics-stat-value" id="analyticsWeekAverage">0m</div>
                                <div class="analytics-stat-label">Daily Average</div>
                            </div>
                            <div class="analytics-stat-card">
                                <div class="analytics-stat-value" id="analyticsTotalTime">0h</div>
                                <div class="analytics-stat-label">All Time</div>
                            </div>
                            <div class="analytics-stat-card">
                                <div class="analytics-stat-value" id="analyticsSitesCount">0</div>
                                <div class="analytics-stat-label">Sites Tracked</div>
                            </div>
                        </div>
                    </div>

                    <!-- Usage Trend Chart -->
                    <div class="settings-section">
                        <div class="chart-header">
                            <h2>Usage Trends</h2>
                            <div class="chart-controls">
                                <div class="chart-period-selector">
                                    <button class="period-btn active" data-period="week">Week</button>
                                    <button class="period-btn" data-period="month">Month</button>
                                    <button class="period-btn" data-period="year">Year</button>
                                </div>
                                <div class="chart-navigation">
                                    <button class="nav-btn" id="chartPrev" title="Previous">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                                        </svg>
                                    </button>
                                    <span class="chart-period-label" id="chartPeriodLabel">This Week</span>
                                    <button class="nav-btn" id="chartNext" title="Next">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" id="usageChart">
                            <div class="chart-area">
                                <div class="chart-y-axis" id="chartYAxis"></div>
                                <div class="chart-content" id="chartContent"></div>
                            </div>
                            <div class="chart-x-axis" id="chartXAxis"></div>
                            <div class="chart-earliest-indicator" id="chartEarliestIndicator" style="display: none;">
                                <div class="earliest-line"></div>
                                <span class="earliest-label">Tracking started</span>
                            </div>
                        </div>
                    </div>

                    <!-- Heatmap Calendar -->
                    <div class="settings-section">
                        <div class="chart-header">
                            <h2>Activity Heatmap</h2>
                            <div class="heatmap-controls">
                                <select id="heatmapFilter" class="heatmap-filter-select">
                                    <option value="all">All Sites</option>
                                    <option value="restricted">Restricted Sites Only</option>
                                </select>
                            </div>
                        </div>
                        <div class="heatmap-container" id="heatmapContainer">
                            <div class="heatmap-months" id="heatmapMonths"></div>
                            <div class="heatmap-grid-wrapper">
                                <div class="heatmap-days">
                                    <span>Mon</span>
                                    <span>Wed</span>
                                    <span>Fri</span>
                                </div>
                                <div class="heatmap-grid" id="heatmapGrid"></div>
                            </div>
                            <div class="heatmap-legend">
                                <span class="heatmap-legend-label">Less</span>
                                <div class="heatmap-legend-scale">
                                    <div class="heatmap-cell" data-level="0"></div>
                                    <div class="heatmap-cell" data-level="1"></div>
                                    <div class="heatmap-cell" data-level="2"></div>
                                    <div class="heatmap-cell" data-level="3"></div>
                                    <div class="heatmap-cell" data-level="4"></div>
                                </div>
                                <span class="heatmap-legend-label">More</span>
                                <div class="heatmap-earliest" id="heatmapEarliestIndicator">
                                    <span class="earliest-dot"></span>
                                    <span class="earliest-text">= Tracking started</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Sites -->
                    <div class="settings-section">
                        <h2>Top Sites Today</h2>
                        <div class="analytics-sites-list" id="analyticsTopSites">
                            <div class="analytics-empty-state">No activity recorded today.</div>
                        </div>
                    </div>

                    <!-- Settings -->
                    <div class="settings-section">
                        <h2>Tracking Settings</h2>
                        <div class="setting-group">
                            <label for="trackingFrequency">
                                Tracking Interval (seconds)
                                <span class="info-tooltip"
                                    title="How often the extension updates your time logs. Lower values are more accurate but use more resources.">?</span>
                            </label>
                            <input type="number" id="trackingFrequency" min="0.1" max="60" step="0.01"
                                placeholder="1.00" />
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div id="privacy" class="tab-pane">
                    <div class="settings-section">
                        <h2>Privacy Policy</h2>
                        <p style="text-indent: 2em;">
                            TimeDash follows a strict local-first design. The extension does not collect, log, transmit,
                            aggregate, or monetize any data. No browsing history, usage metrics, identifiers, or
                            personal information are observed or retained. We do not embed analytics frameworks,
                            telemetry systems, advertising SDKs, or third-party scripts of any kind. Nothing is measured
                            remotely because nothing is sent.
                        </p>
                        <p style="text-indent: 2em;">
                            All data produced by TimeDash exists only inside your browser. This includes time tracking
                            records, playback speed preferences, blocked site rules, and internal configuration state.
                            Storage uses Chromeâ€™s native secure storage APIs and remains bound to your local profile. No
                            network requests ever carry user data. Nothing syncs to servers. Nothing leaves the device.
                        </p>
                        <p style="text-indent: 2em;">
                            You retain complete control and ownership of all data at all times. You may export your data
                            as a JSON file for inspection, backup, or migration whenever you choose. If you uninstall
                            the extension, Chrome removes all associated storage immediately and irreversibly. No
                            residual copies remain. No recovery is possible because nothing was externalized.
                        </p>
                    </div>

                    <div class="settings-section">
                        <h2>Tracking Control</h2>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="trackingPaused" />
                                <span class="checkmark"></span>
                                Pause Tracking
                                <small>Temporarily stop all data collection</small>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="incognitoTracking" />
                                <span class="checkmark"></span>
                                Enable Incognito Tracking
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Domain Whitelist</h2>
                        <p class="section-description">These sites will never be tracked.</p>
                        <div class="rule-manager">
                            <div class="rule-input-group">
                                <input type="text" id="whitelistInput" placeholder="e.g. localhost"
                                    class="rule-domain-input" />
                                <button id="addWhitelistBtn" class="btn btn-primary">Add</button>
                            </div>
                            <ul class="rule-list" id="whitelistList">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Data Management</h2>
                        <div class="setting-group">
                            <label class="setting-label">
                                <input type="checkbox" id="autoPurgeEnabled" />
                                <span class="checkmark"></span>
                                Auto-purge old data
                            </label>
                            <div class="dependent-setting" id="autoPurgeSettings"
                                style="margin-left: 28px; margin-top: 10px; display: none;">
                                <label>
                                    Delete data older than
                                    <input type="number" id="autoPurgeDays" min="1" max="3650" placeholder="30"
                                        style="width: 80px; padding: 4px;" /> days
                                </label>
                            </div>
                            <p class="setting-note"
                                style="margin-top: 8px; color: var(--text-secondary); font-size: 0.9em;">
                                Note: All data is stored locally on your device. We do not transmit your data.
                            </p>
                        </div>

                        <div class="storage-meter-container"
                            style="margin: 20px 0; background: var(--bg-secondary); padding: 16px; border-radius: var(--radius);">
                            <div class="storage-header"
                                style="display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 500;">
                                <span>Storage Usage</span>
                                <span id="storageUsageValue">Checking...</span>
                            </div>
                            <div class="storage-bar-bg"
                                style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                                <div class="storage-bar-fill" id="storageUsageFill"
                                    style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s ease;">
                                </div>
                            </div>
                            <div id="storageQuotaValue"
                                style="font-size: 0.8em; color: var(--text-secondary); margin-top: 4px; text-align: right;">
                            </div>
                        </div>

                        <h3>Manage Stored Data</h3>
                        <div class="data-search-group" style="margin-bottom: 15px;">
                            <input type="text" id="deleteDataSearch" placeholder="Search domain to delete data..."
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary);" />
                            <div id="deleteDataResults" class="rule-list"
                                style="max-height: 200px; overflow-y: auto; display: none; border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 var(--radius) var(--radius);">
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button id="importData" class="btn btn-outline" style="flex: 1;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
                                    style="margin-right: 8px; vertical-align: text-bottom;">
                                    <path
                                        d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M13,11V15H11V11H9L12,8L15,11H13Z" />
                                </svg>
                                Import Data
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" />

                            <button id="exportDataPrivacy" class="btn btn-outline" style="flex: 1;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
                                    style="margin-right: 8px; vertical-align: text-bottom;">
                                    <path
                                        d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                                </svg>
                                Export My Data
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Help & Documentation -->
                <div id="help" class="tab-pane">
                    <div class="settings-section">
                        <h2>Features Overview</h2>
                        <div class="help-item">
                            <h3>Time Tracking</h3>
                            <p>TimeDash automatically tracks how much time you spend on each website. View your daily
                                usage in the popup or the Analytics tab.</p>
                        </div>
                        <div class="help-item">
                            <h3>Video Speed Control</h3>
                            <p>Control playback speed on YouTube, Vimeo, and most other video sites. Use keyboard
                                shortcuts or the popup menu to adjust speed.</p>
                        </div>
                        <div class="help-item">
                            <h3>Site Blocking</h3>
                            <p><strong>Hard Block:</strong> Completely prevents access to a site.</p>
                            <p><strong>Restricted Access:</strong> Allows a specific amount of time per day. Once
                                exceeded, access is blocked until midnight.</p>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2>Keyboard Shortcuts</h2>
                        <table class="shortcuts-table" style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);"><strong>Increase
                                        Speed</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);">Adjustable in Video
                                    Settings</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);"><strong>Decrease
                                        Speed</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);">Adjustable in Video
                                    Settings</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);"><strong>Toggle
                                        Tracking</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);">Alt + T</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);"><strong>Block
                                        Site</strong></td>
                                <td style="padding: 8px; border-bottom: 1px solid var(--border);">Alt + B</td>
                            </tr>
                        </table>
                    </div>

                    <div class="settings-section">
                        <h2>Privacy Policy</h2>
                        <p>Please see our full <a href="#privacy" id="viewPrivacyLink"
                                style="color: var(--primary-color); text-decoration: underline;">Privacy Policy</a> in
                            the Privacy tab.</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Save Status -->
        <div class="save-status" id="saveStatus">
            <span class="save-message">Settings saved automatically</span>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="confirmTitle">Confirm Action</h3>
            <p id="confirmMessage">Are you sure you want to proceed?</p>
            <div class="modal-actions">
                <button id="confirmCancel" class="btn btn-outline">Cancel</button>
                <button id="confirmOk" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <div id="toast-notification" class="toast"></div>

    <script src="../utils/storage.js"></script>
    <script src="../utils/i18n.js"></script>
    <script type="module" src="options.js"></script>
</body>

</html>